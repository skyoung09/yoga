# Copyright (c) 2014-present, Facebook, Inc.
# All rights reserved.
#
# This source code is licensed under the BSD-style license found in the
# LICENSE file in the root directory of this source tree. An additional grant
# of patent rights can be found in the PATENTS file in the same directory.

os: osx
osx_image: xcode8.2
language: cpp
compiler: clang

env:
  - TARGET=c
  - TARGET=java

before_install:
  - brew update > /dev/null
  - brew install --HEAD facebook/fb/buck

  # Java
  - |
    if [[ $TARGET = "java" ]]; then
      brew cask install java &&
      export JAVA_HOME=$(/usr/libexec/java_home -v 1.8) &&
      export PATH=$JAVA_HOME/bin:$PATH
    fi


script:
  # C
  - |
    if [[ $TARGET = "c" ]]; then
      buck test --verbose 0 //:yoga &&
      buck run --verbose 0 //benchmark:benchmark &&
      git checkout HEAD^ &&
      buck run --verbose 0 //benchmark:benchmark
    fi

  # Java
  - |
    if [[ $TARGET = "java" ]]; then
      buck test --verbose 0 //java:java
    fi

